<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advosub.ai</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <h1>Advosub Newsletter</h1>
    
    {% if success %}
    <div class="alert success">
        <p>Thank you for your submission! Your information has been saved.</p>
    </div>
    {% endif %}
    
    {% if error %}
    <div class="alert error">
        <p>{{ error }}</p>
    </div>
    {% endif %}
    
    <form method="POST">
        <div class="form-group">
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" required>
        </div>
        
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
        </div>

        <div class="form-group">
            <label for="interests">Interests:</label>
            <div class="interest-selection">
                <input type="text" id="interest-input" placeholder="Type an interest...">
                <div id="suggestions" class="suggestions-container"></div>
            </div>
            <div id="selected-interests" class="selected-interests-container"></div>
            <div id="hidden-inputs"></div>
        </div>
        
        <div class="form-group">
            <label for="frequency">Frequency:</label>
            <select id="frequency" name="frequency" required>
                <option value="">Select frequency</option>
                <option value="weekly">Weekly</option>
                <option value="biweekly">Biweekly</option>
                <option value="monthly">Monthly</option>
            </select>
        </div>
        
        <button type="submit">Submit</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Predefined interests similar to those in the image
            const predefinedInterests = [
                "Sustainable Development",
                "Climate Change",
                "Environmental Policy",
                "Renewable Energy",
                "Waste Management",
                "Water Resources",
                "Sustainable Agriculture",
            ];
            
            const interestInput = document.getElementById('interest-input');
            const suggestionsContainer = document.getElementById('suggestions');
            const selectedInterestsContainer = document.getElementById('selected-interests');
            const hiddenInputsContainer = document.getElementById('hidden-inputs');
            
            let selectedInterests = [];
            
            // Function to update hidden inputs for form submission
            function updateHiddenInputs() {
                hiddenInputsContainer.innerHTML = '';
                selectedInterests.forEach((interest, index) => {
                    const hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = 'topics[]';
                    hiddenInput.value = interest;
                    hiddenInputsContainer.appendChild(hiddenInput);
                });
                
                // For debugging - log the hidden inputs
                console.log("Hidden inputs updated:", selectedInterests);
            }
            
            // Function to add an interest to the selected list
            function addInterest(interest) {
                if (interest && !selectedInterests.includes(interest)) {
                    selectedInterests.push(interest);
                    
                    const interestTag = document.createElement('div');
                    interestTag.className = 'interest-tag';
                    
                    const interestText = document.createElement('span');
                    interestText.textContent = interest;
                    
                    const removeButton = document.createElement('button');
                    removeButton.type = 'button';
                    removeButton.className = 'remove-interest';
                    removeButton.innerHTML = '&times;';
                    removeButton.setAttribute('aria-label', 'Remove ' + interest);
                    
                    removeButton.addEventListener('click', function() {
                        selectedInterestsContainer.removeChild(interestTag);
                        selectedInterests = selectedInterests.filter(item => item !== interest);
                        updateHiddenInputs();
                    });
                    
                    interestTag.appendChild(interestText);
                    interestTag.appendChild(removeButton);
                    selectedInterestsContainer.appendChild(interestTag);
                    
                    updateHiddenInputs();
                }
                
                // Clear the input and suggestions
                interestInput.value = '';
                suggestionsContainer.innerHTML = '';
            }
            
            // Event listener for input to show suggestions
            interestInput.addEventListener('input', function() {
                const inputValue = this.value.trim().toLowerCase();
                suggestionsContainer.innerHTML = '';
                
                if (inputValue) {
                    const matchingInterests = predefinedInterests.filter(interest => 
                        interest.toLowerCase().includes(inputValue)
                    );
                    
                    matchingInterests.forEach(interest => {
                        const suggestion = document.createElement('div');
                        suggestion.className = 'suggestion';
                        suggestion.textContent = interest;
                        
                        suggestion.addEventListener('click', function() {
                            addInterest(interest);
                        });
                        
                        suggestionsContainer.appendChild(suggestion);
                    });
                }
            });
            
            // Event listener for Enter key to add custom interest
            interestInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const customInterest = this.value.trim();
                    if (customInterest) {
                        addInterest(customInterest);
                    }
                }
            });
            
            // Close suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (e.target !== interestInput && !suggestionsContainer.contains(e.target)) {
                    suggestionsContainer.innerHTML = '';
                }
            });
            
            // Add alert styling
            const style = document.createElement('style');
            style.textContent = `
                .alert {
                    padding: 15px;
                    margin-bottom: 20px;
                    border-radius: 4px;
                    width: 90%;
                    max-width: 600px;
                    margin-left: auto;
                    margin-right: auto;
                }
                .success {
                    background-color: #d4edda;
                    color: #155724;
                    border: 1px solid #c3e6cb;
                }
                .error {
                    background-color: #f8d7da;
                    color: #721c24;
                    border: 1px solid #f5c6cb;
                }
            `;
            document.head.appendChild(style);
            
            // Add form submission event listener for debugging
            document.querySelector('form').addEventListener('submit', function(e) {
                console.log("Form submitted with interests:", selectedInterests);
                // Don't prevent default - let the form submit normally
            });
        });
    </script>
</body>
</html> 